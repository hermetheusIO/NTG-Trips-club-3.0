Entendo. Voc√™ n√£o vai ‚Äúusar‚Äù a Teresa agora. Voc√™ quer entregar ao Replit AI o pacote completo: o agente Teresa Creator + onde ele vive na arquitetura + como validar + como encaixar nas rotas/tabelas existentes. Ou seja: ‚ÄúReplit, coloca isso dentro do app sem transformar a plataforma num reality show‚Äù.

Abaixo vai um PROMPT √öNICO, pronto para colar no Replit AI, j√° com:
	‚Ä¢	defini√ß√£o do agente (system prompt)
	‚Ä¢	endpoint
	‚Ä¢	UI (p√°gina criar roteiro)
	‚Ä¢	valida√ß√µes anti-caos
	‚Ä¢	integra√ß√£o com trips (propostas)
	‚Ä¢	feature flag
	‚Ä¢	sem quebrar nada do que j√° existe

‚∏ª


# PROMPT PARA REPLIT AI ‚Äî Implementar ‚ÄúAgente Teresa Creator‚Äù no sistema atual (sem caos)

Voc√™ √© o Replit AI. Quero que voc√™ implemente um **Agente de IA chamado Teresa Creator** dentro do sistema existente, de forma incremental e backward compatible, anexando √† arquitetura atual sem quebrar rotas, componentes, banco ou fluxos j√° existentes.

## 0) Regras obrigat√≥rias de implementa√ß√£o
- Migrations apenas ADITIVAS (n√£o renomear/remover colunas/tabelas existentes).
- Feature flag `FEATURE_TRIPS_CLUB_CREATOR` (default false) para ligar/desligar.
- N√£o mudar URLs existentes. Adicionar somente rotas novas necess√°rias no padr√£o atual.
- Implementar em fases pequenas e seguras (commits coerentes).

## 1) Onde isso entra no produto (vis√£o)
Objetivo: permitir que **membros do NTG Trips Club** criem um ‚Äúroteiro-proposta‚Äù via UI com ajuda da Teresa Creator, obtendo um JSON estruturado que vira uma proposta em `trips` (status `pending_review`), e depois o Admin aprova para `voting`.

Importante: esses roteiros s√£o **bate-volta** com:
- sa√≠da e volta sempre de Coimbra
- 1 ou 2 paradas principais
- em cada parada: 1 experi√™ncia gratuita + 1 experi√™ncia paga opcional
- duas programa√ß√µes: Essencial (econ√≥mica) e Completa (paga)

## 2) Integra√ß√£o com arquitetura atual (conforme projeto existente)
- Frontend: React/Vite/TS + Tailwind + Wouter
- Backend: Express/TS em /api/*
- DB: Postgres + Drizzle
- Auth: Replit Auth
- Tabelas existentes: trips, userProfiles, tripFavorites, tripGallery/mediaAssets, etc.

## 3) Mudan√ßas no banco (m√≠nimas e compat√≠veis)
Reaproveitar `trips` como tabela principal de propostas. Adicionar colunas (aditivas) para suportar a Teresa Creator:
- `sourceType` ('ntg'|'member') default 'ntg'
- `createdByUserId` nullable
- `proposalStatus` ('pending_review'|'voting'|'ready_to_schedule'|'archived') default 'pending_review'
- `startCity` default 'Coimbra'
- `stopsJson` JSON (array de 1‚Äì2 paradas com freeExperience/paidExperience)
- `itineraryEssential` JSON
- `itineraryComplete` JSON
- `priceRangeEssential` JSON {min,max}
- `priceRangeComplete` JSON {min,max}
- `tags` JSON array
- `capacity` int default 10
- `viabilityRule` JSON {minInterested} default {minInterested: 10}

Se j√° existir campo semelhante, reutilize e apenas complemente.

## 4) Endpoint do agente (backend)
Criar endpoint:
- `POST /api/teresa/proposal-draft`

### Input (body)
- `userMessage`: string (pedido do utilizador)
- `preferences` (optional): objeto com budget, estilo, mobilidade, p√∫blico, etc.

### Output (JSON)
O endpoint deve retornar um JSON no formato exato abaixo (contrato):

```json
{
  "title": "string",
  "subtitle": "string",
  "narrativeShort": "string",
  "startCity": "Coimbra",
  "stops": [
    {
      "name": "string",
      "freeExperience": { "label": "string", "details": "string" },
      "paidExperience": { "label": "string", "details": "string" },
      "effort": "leve | moderada"
    }
  ],
  "durationHoursEst": 8,
  "difficulty": "leve | moderada",
  "priceEstimated": {
    "essential": { "min": 0, "max": 0 },
    "complete": { "min": 0, "max": 0 }
  },
  "itinerary": {
    "essential": [{ "time": "HH:MM", "label": "string", "details": "string" }],
    "complete": [{ "time": "HH:MM", "label": "string", "details": "string" }]
  },
  "includes": ["Acompanhamento NTG", "Curadoria do percurso", "√Ålbum digital (fotos+v√≠deos)"],
  "excludes": ["Alimenta√ß√£o", "Entradas/experi√™ncias pagas (na Essencial)"],
  "optionalAddOns": [
    { "name": "Sess√£o individual", "description": "string", "priceSuggestion": { "min": 0, "max": 0 } }
  ],
  "tags": ["string"],
  "capacitySuggestion": 10,
  "viabilityRule": { "minInterested": 10 },
  "coverImagePrompt": "string"
}

5) System Prompt da Teresa Creator (cole exatamente este texto)

Use este texto como instru√ß√£o do modelo (system prompt). A Teresa deve obedecer SEMPRE:

Voc√™ √© a Teresa, criadora de roteiros do NTG Trips Club. Voc√™ cria roteiros REALISTAS, simples e execut√°veis, sempre em bate-volta.

REGRAS INEGOCI√ÅVEIS:
1) Sa√≠da e volta SEMPRE: Coimbra (Portugal).
2) O roteiro deve ter exatamente 1 ou 2 PARADAS PRINCIPAIS. N√£o mais do que isso.
3) Para cada parada, inclua:
   - 1 experi√™ncia GRATUITA
   - 1 experi√™ncia PAGA opcional
4) Gere duas vers√µes:
   - ESSENCIAL (econ√≥mica): apenas experi√™ncias gratuitas (sem obrigar gasto)
   - COMPLETA (paga): inclui as experi√™ncias pagas opcionais
5) Dura√ß√£o total: 8‚Äì12 horas. Com 2 paradas: 10‚Äì12h.
6) Log√≠stica realista a partir de Coimbra. Evite destinos extremos:
   - 1¬™ parada preferencialmente at√© ~2h30 de Coimbra
   - condu√ß√£o total somada ideal <= 5h30
   - se o pedido for longe demais, reduza para 1 parada ou proponha alternativa pr√≥xima
7) Ritmo confort√°vel e pausas (caf√©, WC, descanso).
8) PT-PT, claro, sem exageros.
9) N√£o invente factos garantidos (hor√°rios, regras de entrada). Use ‚Äúnormalmente‚Äù, ‚Äúem geral‚Äù.
10) Nunca quebre as regras 1‚Äì4.

Agora gere um rascunho seguindo EXATAMENTE o formato JSON exigido.

6) Valida√ß√µes anti-caos no backend (obrigat√≥rias)

Ap√≥s receber o JSON do modelo, valide antes de devolver/salvar:
	‚Ä¢	startCity === ‚ÄúCoimbra‚Äù
	‚Ä¢	stops.length √© 1 ou 2
	‚Ä¢	cada stop cont√©m freeExperience e paidExperience
	‚Ä¢	durationHoursEst entre 8 e 12
	‚Ä¢	itinerary.essential e itinerary.complete n√£o vazios
	‚Ä¢	price ranges coerentes (min < max)
Se falhar, fa√ßa 1 retry autom√°tico: re-chame o modelo dizendo ‚ÄúVoc√™ violou a regra X. Corrija mantendo o mesmo formato JSON.‚Äù
Se falhar novamente, retorne erro claro para UI.

7) UI (frontend) ‚Äî criar roteiro com Teresa

Criar p√°gina nova:
	‚Ä¢	/trips-club/criar (vis√≠vel s√≥ se FEATURE_TRIPS_CLUB_CREATOR=true e membership ativa)

Componentes:
	‚Ä¢	Campo texto ‚ÄúDescreva seu bate-volta ideal‚Äù
	‚Ä¢	Bot√£o ‚ÄúGerar com Teresa‚Äù
	‚Ä¢	Exibir preview edit√°vel do JSON (formul√°rio amig√°vel: t√≠tulo, paradas, experi√™ncias, itiner√°rio)
	‚Ä¢	Bot√£o ‚ÄúSalvar rascunho‚Äù
	‚Ä¢	Bot√£o ‚ÄúEnviar para revis√£o‚Äù

Salvar como trips:
	‚Ä¢	sourceType=‚Äòmember‚Äô
	‚Ä¢	createdByUserId=user.id
	‚Ä¢	proposalStatus=‚Äòpending_review‚Äô
	‚Ä¢	startCity=‚ÄòCoimbra‚Äô
	‚Ä¢	stopsJson + itiner√°rios + price ranges + tags + capacity + viabilityRule

8) Admin (m√≠nimo necess√°rio)

No Admin dashboard existente:
	‚Ä¢	Lista ‚ÄúPropostas pendentes‚Äù (proposalStatus=‚Äòpending_review‚Äô)
	‚Ä¢	Bot√£o ‚ÄúAprovar para vota√ß√£o‚Äù ‚Üí proposalStatus=‚Äòvoting‚Äô
	‚Ä¢	Bot√£o ‚ÄúArquivar‚Äù

9) Entreg√°veis finais

Ao final, entregue:
	‚Ä¢	migrations + schema atualizado
	‚Ä¢	endpoints criados
	‚Ä¢	p√°ginas/componentes criados
	‚Ä¢	onde foi aplicado o feature flag
	‚Ä¢	confirma√ß√£o de backward compatibility com /trips-club e /viagens/*

Implemente em fases pequenas e seguras.

---

## üß† Como voc√™ poderia pedir isso melhor
**O que funcionou bem:** voc√™ deixou claro o objetivo real: entregar o agente ao Replit para ele incorporar no produto.  
**O que faltou especificar:** qual provedor/modelo o backend vai usar (OpenAI/Outro) e como voc√™s guardam secrets no Replit (assumi que j√° existe padr√£o).  
**Exemplo de prompt reescrito:**  
> ‚ÄúGere um prompt √∫nico para o Replit AI implementar o agente Teresa Creator dentro do nosso app atual, incluindo system prompt, endpoint, valida√ß√µes anti-caos, UI de cria√ß√£o e integra√ß√£o com a tabela trips, tudo com feature flag e migrations aditivas.‚Äù