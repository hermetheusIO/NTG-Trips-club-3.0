# NTG Trips Club ‚Äî Especifica√ß√£o para Replit (MVP + Evolu√ß√£o)
> Objetivo: implementar o sistema do **NTG Trips Club** na plataforma NTG, com **roteiros-proposta** para vota√ß√£o, **lista de interessados** (com op√ß√£o an√≥nimo), regras de **vantagens para membros**, e a l√≥gica de **abrir viagem** (definir data + pre√ßo final + reservas) quando houver tra√ß√£o suficiente.

---

## 1) Conceito do Produto (Club)
### O que √©
O **NTG Trips Club** √© um clube onde a NTG publica **Roteiros-Proposta (sem data fixa)** para os Travellers:
1) **votarem**
2) **entrarem na lista de interessados**
3) quando atingir um m√≠nimo vi√°vel ‚Üí a NTG **abre a viagem** (data + pre√ßo final + reservas)

### Regras fixas (todas as viagens NTG)
- **Todas as viagens s√£o documentadas** (fotos + v√≠deos) e entregues num **√Ålbum Digital** para todos os participantes fazerem download.
- √â poss√≠vel contratar **sess√£o individual** (retrato, casal, fam√≠lia) como **add-on**.
- Toda viagem tem sempre **2 programa√ß√µes**:
  - **Essencial (econ√≥mica)**: sem obrigar gastos (paisagens, centros hist√≥ricos, trilhos, miradouros etc.)
  - **Completa (paga)**: visitas/experi√™ncias opcionais (castelos, museus, barco, provas de vinho etc.)
- O grupo pode alternar entre op√ß√µes sem constrangimento; a NTG organiza pontos de encontro em momentos-chave.

---

## 2) Pap√©is e Acesso
### Tipos de utilizador
- **Visitante (n√£o logado)**: pode ver roteiros-proposta e contagem agregada (votos/interessados), mas n√£o vota nem entra na lista.
- **Traveller (logado)**:
  - pode votar e entrar na lista de interessados
  - pode escolher aparecer como **an√≥nimo** na lista p√∫blica
- **Membro do Club (Traveller + membership ativa)**:
  - **desconto (%)** em viagens do Club
  - **prioridade de reserva** (janela antecipada)
  - acesso antecipado a conte√∫dos (ex.: √°lbum publicado primeiro para membros, se quiserem)
- **Admin NTG**:
  - cria/edita roteiros-proposta
  - define m√≠nimo vi√°vel para ‚Äúabrir viagem‚Äù
  - converte proposta em viagem com data/pre√ßo final
  - gere reservas, pagamentos, √°lbum digital e add-ons

### Autentica√ß√£o
- Login com:
  - **WhatsApp (n√∫mero)** + senha (MVP)
  - **Google Auth** (opcional/roadmap)
- Perfil do utilizador:
  - nome
  - telefone/WhatsApp
  - email (opcional)
  - prefer√™ncia de privacidade (default: **an√≥nimo** na lista p√∫blica)

---

## 3) Entidades e Dados (modelo sugerido)
> Pode ser SQL (Postgres/Supabase) ou equivalente. Abaixo √© agn√≥stico, mas pronto para virar tabela.

### 3.1 Users
- id (uuid)
- name
- phone (unique)
- email (optional)
- password_hash (se n√£o for OAuth)
- created_at

### 3.2 Memberships
- id
- user_id
- status: `active | inactive | canceled`
- tier: `club` (MVP)
- discount_percent (ex.: 10, 15)
- priority_window_hours (ex.: 24 ou 48)
- started_at
- ends_at (optional)

### 3.3 TripProposals (Roteiros-Proposta)
- id
- slug (unique)
- title
- subtitle
- region_tags (ex.: `templarios`, `douro`, `centro`, `natureza`)
- start_city = "Coimbra"
- destinations (array/JSON)
- duration_hours_est (ex.: 12)
- group_size_min / group_size_max
- difficulty: `leve | moderada`
- accessibility_notes (texto)
- narrative_short (texto)
- price_estimated_essential_min / max
- price_estimated_complete_min / max
- includes (array/JSON)
- excludes (array/JSON)
- optional_addons (array/JSON)
- club_benefits (texto curto)
- status: `voting | almost_ready | approved | archived`
- viability_rule (JSON) ex.: `{ "min_interested": 10 }` ou `{ "min_votes": 30 }`
- cover_image_url (optional)
- created_at / updated_at

### 3.4 Votes
- id
- proposal_id
- user_id
- vote_value: `up` (MVP simples)
- created_at
> Regra: 1 voto por user por proposta.

### 3.5 Interests (Lista de Interessados)
- id
- proposal_id
- user_id
- public_visibility: `named | anonymous`
- note (optional, ex.: ‚Äúprefiro domingo‚Äù)
- created_at
> Regra: 1 interesse por user por proposta.

### 3.6 TripInstances (Viagens Abertas / com data)
- id
- proposal_id
- title (pode herdar)
- date_start (datetime)
- date_end (datetime)
- meeting_point (texto)
- final_price_essential
- final_price_complete
- capacity_total
- capacity_reserved
- booking_status: `announced | member_priority | public_open | sold_out | completed | canceled`
- member_priority_starts_at / ends_at
- public_sales_starts_at
- itinerary_essential (JSON)
- itinerary_complete (JSON)
- created_at / updated_at

### 3.7 Bookings
- id
- trip_instance_id
- user_id
- package_type: `essential | complete`
- seats (int)
- total_price
- discount_applied_percent (int)
- status: `pending | paid | canceled | refunded`
- created_at

### 3.8 AddOns (Sess√£o individual etc.)
- id
- trip_instance_id
- name (ex.: ‚ÄúSess√£o Individual 30min‚Äù)
- description
- price
- capacity (optional)
- active (bool)

### 3.9 BookingAddOns
- id
- booking_id
- addon_id
- quantity
- total_price

### 3.10 MediaAlbums (√Ålbum Digital)
- id
- trip_instance_id
- title
- description
- visibility: `participants_only | club_first_then_participants` (opcional)
- published_at
- download_enabled (bool)
- created_at

### 3.11 MediaItems
- id
- album_id
- type: `photo | video`
- url
- thumb_url (optional)
- filename
- created_at

---

## 4) Regras de Neg√≥cio (l√≥gica do sistema)
### 4.1 Vota√ß√£o e Interesse
- Proposta tem contadores:
  - `votes_count`
  - `interested_count`
- Utilizador pode:
  - votar (1x)
  - entrar na lista (1x)
  - escolher aparecer como **an√≥nimo** na lista p√∫blica

### 4.2 Crit√©rio para ‚Äúabrir viagem‚Äù
- Quando atingir `viability_rule` (ex.: min_interested = 10):
  - Admin recebe indica√ß√£o ‚ÄúPronto para abrir‚Äù
  - Admin cria `TripInstance` com data + pre√ßo final + capacidade + janelas de venda

### 4.3 Vantagens para Membros
- Membro do Club:
  - aplica `discount_percent` no pre√ßo final (essential/complete)
  - tem **priority window** (ex.: 24‚Äì48h) antes de abrir ao p√∫blico
- UI deve mostrar:
  - ‚ÄúPre√ßo para membros‚Äù e ‚ÄúPre√ßo normal‚Äù
  - timer/estado: `member_priority` vs `public_open`

### 4.4 Duas programa√ß√µes (Essencial vs Completa)
- Cada TripInstance deve ter:
  - itiner√°rio Essencial (sem entradas pagas obrigat√≥rias)
  - itiner√°rio Completo (inclui visitas pagas opcionais)
- No booking, o utilizador escolhe o package:
  - `essential` ou `complete`
- Itens pagos podem ser:
  - inclu√≠dos no `complete` ou como add-on

### 4.5 √Ålbum Digital
- Ap√≥s viagem `completed`, Admin publica √°lbum:
  - participantes recebem acesso
  - download liberado (zip opcional)
- Sess√µes individuais:
  - entregas separadas (pasta/link dedicado), associadas ao Booking/AddOn

---

## 5) UI/UX (p√°ginas m√≠nimas do MVP)
### 5.1 P√°gina: /club (feed de roteiros-proposta)
Cards com:
- capa, t√≠tulo, subt√≠tulo
- destinos (chips)
- pre√ßo estimado (range Essencial e Completa)
- contadores: votos + interessados
- CTA:
  - ‚ÄúVotar‚Äù
  - ‚ÄúTenho interesse‚Äù
  - ‚ÄúVer detalhes‚Äù

### 5.2 P√°gina: /club/p/:slug (detalhe do roteiro-proposta)
Se√ß√µes:
- narrativa curta
- mapa mental do dia (timeline simples)
- duas programa√ß√µes (Essencial vs Completa)
- inclui / n√£o inclui
- pre√ßo estimado (range)
- vota√ß√£o + interessados
- lista p√∫blica (nomes ou ‚ÄúTraveller An√≥nimo‚Äù)
- CTA: votar + interesse (toggle an√≥nimo)

### 5.3 P√°gina: /trips (viagens abertas com data)
Lista de TripInstances com:
- data
- capacidade restante
- estado (member_priority / public_open / sold_out)
- pre√ßos (membro vs normal)
- CTA: reservar

### 5.4 P√°gina: /trips/:id (detalhe da viagem aberta)
- itiner√°rio Essencial e Completo (tabs)
- regras de encontro, dura√ß√£o, notas de acessibilidade
- booking (package, lugares, add-ons)
- pol√≠tica de cancelamento (texto simples)
- ap√≥s conclus√£o: acesso ao √°lbum (se participante)

### 5.5 √Årea do utilizador: /me
- membership status
- votos/interesses
- reservas
- √°lbuns dispon√≠veis

### 5.6 Admin (MVP)
- CRUD TripProposals
- ver m√©tricas por proposta (votos/interesse)
- bot√£o ‚ÄúAbrir viagem‚Äù ‚Üí cria TripInstance
- gerir TripInstances (datas, pre√ßos, capacidade, janelas)
- upload/gest√£o do √°lbum

---

## 6) API (endpoints sugeridos)
### Propostas
- GET `/api/proposals`
- GET `/api/proposals/:slug`
- POST `/api/proposals/:id/vote`
- POST `/api/proposals/:id/interest` (body: { visibility, note })
- DELETE `/api/proposals/:id/interest` (optional)

### Viagens abertas
- GET `/api/trips`
- GET `/api/trips/:id`
- POST `/api/trips/:id/book` (package, seats, addons)
- POST `/api/payments` (se houver integra√ß√£o)

### √Ålbum
- GET `/api/albums/:trip_id` (autoriza√ß√£o: participante)
- POST `/api/admin/albums` (admin)
- POST `/api/admin/media-items` (admin upload)

---

## 7) Conte√∫do fixo (copy para usar em todas as p√°ginas do Club)
### Bloco ‚ÄúMem√≥rias inclu√≠das‚Äù
> **üì∏ Mem√≥rias inclu√≠das**  
> Todas as viagens NTG incluem registo fotogr√°fico e em v√≠deo, entregue num √Ålbum Digital exclusivo para os participantes. Todos podem fazer download ap√≥s a viagem.

### Bloco ‚ÄúDuas programa√ß√µes‚Äù
> **üéüÔ∏è Duas formas de viver a mesma viagem**  
> Em todas as rotas existe uma programa√ß√£o Essencial (econ√≥mica) e uma programa√ß√£o Completa (com visitas pagas opcionais). Voc√™ escolhe sem press√£o, no dia.

### Bloco ‚ÄúSess√£o individual‚Äù
> **‚ú® Sess√µes individuais (opcional)**  
> Quer fotos s√≥ suas, em casal ou em fam√≠lia? Pode contratar uma sess√£o dedicada durante a viagem (sujeito a disponibilidade).

---

## 8) Roteiros-Proposta sugeridos (seed inicial do Club)
> Todos saem de Coimbra e t√™m no m√≠nimo 2 destinos.

### 8.1 Rota dos Templ√°rios
- **title:** Rota dos Templ√°rios
- **subtitle:** Pedra, sil√™ncio e hist√≥ria sem pressa
- **destinations:** Tomar + (Dornes OU Castelo de Almourol)
- **duration:** 10‚Äì12h
- **group:** 6‚Äì12
- **difficulty:** leve
- **price_estimated:**
  - essential: ‚Ç¨45‚Äì55
  - complete: ‚Ç¨75‚Äì95
- **includes:**
  - acompanhamento NTG
  - curadoria cultural
  - √°lbum digital (fotos + v√≠deos)
- **excludes:**
  - entradas (na Essencial)
  - almo√ßo
- **complete_option_examples:**
  - Convento de Cristo (Tomar)
  - Barco para Castelo de Almourol
- **club_benefits:** -10% e prioridade de reserva
- **status:** voting
- **viability_rule:** min_interested = 10

### 8.2 Rota N222 Douro
- **title:** Rota N222 ‚Äî Douro Essencial
- **subtitle:** A estrada mais bonita de Portugal n√£o aceita pressa
- **destinations:** Peso da R√©gua + Pinh√£o
- **duration:** 12‚Äì14h
- **group:** 6‚Äì10
- **difficulty:** leve
- **price_estimated:**
  - essential: ‚Ç¨70‚Äì85
  - complete: ‚Ç¨110‚Äì130
- **includes:** acompanhamento + paragens panor√¢micas + √°lbum digital
- **excludes:** cruzeiro/prova (se n√£o inclu√≠do no complete)
- **complete_option_examples:**
  - mini-cruzeiro no Douro
  - prova em quinta pequena
- **club_benefits:** -15% em experi√™ncias e prioridade em √©pocas especiais
- **status:** almost_ready
- **viability_rule:** min_interested = 8

### 8.3 F√©, Pedra e Mar
- **title:** F√°tima / Alcoba√ßa / Nazar√©
- **subtitle:** Tr√™s for√ßas de Portugal em um dia
- **destinations:** F√°tima + Alcoba√ßa + Nazar√©
- **duration:** 11‚Äì13h
- **group:** 8‚Äì14
- **difficulty:** leve
- **price_estimated:**
  - essential: ‚Ç¨50‚Äì60
  - complete: ‚Ç¨85‚Äì100
- **includes:** acompanhamento + curadoria + √°lbum digital
- **excludes:** entrada Mosteiro (se Essencial) + almo√ßo
- **complete_option_examples:**
  - Mosteiro de Alcoba√ßa (entrada)
  - miradouro e s√≠tio da Nazar√© (organizado)
- **club_benefits:** -10% + prioridade
- **status:** voting
- **viability_rule:** min_interested = 12

### 8.4 Ger√™s Essencial
- **title:** Ger√™s ‚Äî Natureza Raiz
- **subtitle:** Portugal antes de existir Portugal
- **destinations:** Terras de Bouro + cascatas/lagoas do Ger√™s
- **duration:** 12‚Äì14h
- **group:** 6‚Äì8
- **difficulty:** moderada (caminhadas leves a moderadas)
- **price_estimated:**
  - essential: ‚Ç¨65‚Äì75
  - complete: ‚Ç¨95‚Äì115
- **includes:** curadoria de trilhos + √°lbum digital
- **excludes:** almo√ßo + guia local (se for add-on)
- **complete_option_examples:**
  - guia local
  - trilho exclusivo (menos tur√≠stico)
- **club_benefits:** -15% + prioridade no ver√£o
- **status:** voting
- **viability_rule:** min_interested = 8

---

## 9) JSON Seed (opcional para popular o banco)
> Ajustar ao teu schema real.

```json
{
  "trip_proposals": [
    {
      "slug": "rota-dos-templarios",
      "title": "Rota dos Templ√°rios",
      "subtitle": "Pedra, sil√™ncio e hist√≥ria sem pressa",
      "start_city": "Coimbra",
      "destinations": ["Tomar", "Dornes"],
      "duration_hours_est": 12,
      "group_size_min": 6,
      "group_size_max": 12,
      "difficulty": "leve",
      "price_estimated_essential_min": 45,
      "price_estimated_essential_max": 55,
      "price_estimated_complete_min": 75,
      "price_estimated_complete_max": 95,
      "includes": ["Acompanhamento NTG", "Curadoria cultural", "√Ålbum digital (fotos+v√≠deos)"],
      "excludes": ["Entradas (na Essencial)", "Almo√ßo"],
      "club_benefits": "-10% e prioridade de reserva",
      "status": "voting",
      "viability_rule": { "min_interested": 10 }
    }
  ]
}
